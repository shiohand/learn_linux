# プロセス
- [プロセスとは](#プロセスとは)
- [スケジューリング](#スケジューリング)
- [フォアグラウンドジョブ バックグラウンドジョブ](#フォアグラウンドジョブ-バックグラウンドジョブ)
- [プロセスID](#プロセスid)
  - [psコマンド](#psコマンド)
- [シグナル](#シグナル)
  - [シグナルの送信](#シグナルの送信)
- [`top`コマンド](#topコマンド)
- [プロセス間通信](#プロセス間通信)

## プロセスとは
実行中のプログラムを管理する単位
シェルもプロセスのひとつ

コマンド実行の場合
1. コマンドが実行される
2. シェルが子プロセス(fork)を作成
3. 子プロセスにコマンドの実行(exec)を任せる
4. 子プロセスの終了を待つ
   1. 子プロセスが実行
   2. 終了したら親へ伝える
5. シェルが終了を受け取り、次の処理を待つ

## スケジューリング
ラウンドロビン方式で実行(基本情報の復習)

Run Queue : 待ち行列
タイムスライス : CPU順番がきたときの実行の一定時間
Nice値 : プロセスに与えられる優先度 -20(最高)から19(最低)まで
Nice値は`renice`コマンドで優先度を変更できる

## フォアグラウンドジョブ バックグラウンドジョブ
ジョブはシェルが実行するプログラムの単位

時間のかかるジョブをバックグラウンドで実行させ、別のコマンドを実行させることができる
プログラムの編集中に一旦中断して、プログラムを試行してまた編集に戻るというようなことができる

変更方法

## プロセスID
プロセスにはPID(ユニークなID)が付与される
`echo $$`
自身のPIDを確認

### psコマンド
`ps`
実行中のプロセスのスナップショットを表示

| option   | 動作                                        |
| -------- | ------------------------------------------- |
| `-A`     | 全てのプロセスを選択する                    |
| `e`      | コマンドのあとに環境を表示する              |
| `l` `-l` | 長いフォーマット `-`の有無で少し異なる      |
| `w` `-w` | 出力幅を広げる どちらも指定で制限無しになる |
長いフォーマットでは、PIDにPPID(親のPID)も表示

`pstree`
ツリー上に表示

## シグナル
プロセスを制御するために送信されるイベント

| シグナル番号 | シグナル名 | 意味                         |
| ------------ | ---------- | ---------------------------- |
| 1            | HUP        | ハングアップ Hang Up         |
| 2            | INT        | 割り込み Interrupt           |
| 3            | QUIT       | 強制停止 コアダンプ生成 Quit |
| 9            | KILL       | 強制終了Kill                 |
| 15           | TERM       | 終了 Terminate               |
TERMはKILLのデフォルトシグナル(?)

### シグナルの送信
シェルに設定されているキーの入力
例 : `Ctrl + c` `Ctrl + z` `Ctrl + ¥`など
`kill`コマンド
例 : `kill -HUP PID` `kill -SIGINT PID` `kill -9 PID`など
`kill()`
プログラム内で`kill`関数を実行

## `top`コマンド
`top`
プロセスの状態をダイナミック表示
CPU使用率でのソート、指定したプロセスへのシグナル送信などが可能

## プロセス間通信
プロセス間通信 : 処理の完了のために、複数のプロセスが同期しあい、必要であれば動作を変更する

パイプ(`|`)やシグナルもプロセス間通信の手法のひとつ

他のプロセス間通信の手法
- System V IPC(Inter Process Communication)
  - 共有メモリ(shared memory)
  - セマフォ(semaphore)
  - メッセージキュー(message queue)
- ソケット

それぞれの特徴
- パイプ : ひとつのプロセスの標準入出力をつなぎ替える。パイプ左の標準出力を右の標準入力につなぐ
- シグナル : 特定のシグナルの受信で特定の処理を介しsる
- 共有メモリ : 特定のメモリ領域を複数のプロセスで共有
- セマフォ : 資源のロックを行い、排他処理
- メッセージキュー : キューにメッセージを格納し、非同期の通信を実現
- ソケット : ネットワーク経由のホスト間のプロセスで通信
