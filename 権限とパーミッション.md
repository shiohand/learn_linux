# 権限とパーミッション
- [ユーザーとグループ](#ユーザーとグループ)
  - [ユーザー情報の確認](#ユーザー情報の確認)
    - [/etc/passwd で全てのユーザー情報を確認する](#etcpasswd-で全てのユーザー情報を確認する)
    - [idコマンドで確認する](#idコマンドで確認する)
    - [パスワード情報を確認する](#パスワード情報を確認する)
  - [ユーザー設定](#ユーザー設定)
    - [useradd](#useradd)
    - [usermod](#usermod)
    - [userdel](#userdel)
    - [passwd](#passwd)
  - [グループ設定](#グループ設定)
    - [groupadd](#groupadd)
    - [groupmod](#groupmod)
    - [groupdel](#groupdel)
- [スーパーユーザー(rootユーザー)](#スーパーユーザーrootユーザー)
  - [sudu switch user and do](#sudu-switch-user-and-do)
- [ファイルとパーミッション](#ファイルとパーミッション)
  - [ファイルの権限を確認する](#ファイルの権限を確認する)
    - [ファイルタイプ](#ファイルタイプ)
    - [パーミッション](#パーミッション)
    - [オーナーとグループ](#オーナーとグループ)
  - [パーミッションの設定](#パーミッションの設定)
  - [ファイルのパーミッションを変更する](#ファイルのパーミッションを変更する)
    - [chown](#chown)
    - [chgrp](#chgrp)
    - [chmod](#chmod)
      - [8進数で各対象の権限をまとめて指定する](#8進数で各対象の権限をまとめて指定する)
  - [umask パーミッションの初期値を変更する](#umask-パーミッションの初期値を変更する)

## ユーザーとグループ
ユーザーごとにアカウントをもち、それぞれに権限を設定できる
また、グループを作り複数のユーザーを所属させることで、権限管理をしやすくする
ユーザーは一つ以上のグループに所属しており、メインのグループをプライマリグループと呼ぶ

### ユーザー情報の確認

#### /etc/passwd で全てのユーザー情報を確認する
`$ cat /etc/passwd`
全てのユーザーの情報を出力する
`[ユーザー名]:x:[ユーザーID]:[グループID]:...`

#### idコマンドで確認する
`$ id`
`uid=999(自分のユーザー名) gid=99(グループ名),99(グループ名)...`のように表示される

#### パスワード情報を確認する
パスワードはシャドウファイル`/etc/shadow`に保存される
暗号化されたパスワードや更新日時などが保存されている

### ユーザー設定

#### useradd
`$ useradd ユーザー名`

ユーザーが既存でないか確認する場合はgrep
`$ grep [ユーザーID] /etc/psswd`

| option | 動作                     |
| ------ | ------------------------ |
| -c     | コメントを指定           |
| -g     | プライマリグループを指定 |
| -G     | 補助グループを指定       |
| -d     | ホームディレクトリを指定 |
| -u     | ユーザーIDを指定         |

#### usermod
`$ usermod ユーザー名`

| option | 動作             |
| ------ | ---------------- |
| -l     | ユーザー名を指定 |
| -c     |                  |
| -g     |                  |
| -G     |                  |
| -u     |                  |

#### userdel
`$ userdel ユーザー名`

| option | 動作                     |
| ------ | ------------------------ |
| -r     | ホームディレクトリを削除 |

#### passwd
`$ passwd ユーザー名`

(rootユーザーで)パスワードの変更を行う

### グループ設定
ID100未満はシステム用なので使えない

#### groupadd
`$ groupadd グループ名`

| option | 動作             |
| ------ | ---------------- |
| -g     | グループIDを指定 |
#### groupmod
`$ groupmod グループ名`

| option | 動作             |
| ------ | ---------------- |
| -n     | グループ名を指定 |
#### groupdel
`$ groupdel グループ名`

## スーパーユーザー(rootユーザー)
システムの根幹に関わる作業を行うためのユーザー
システムの変更、ユーザーの作成や削除などを制限なく行える

一般ユーザーから管理コマンドを実行する
`su`コマンドや`visudo`コマンドについては
(必要になったら学びます->Linux標準教科書 第7章)

### sudu switch user and do
`wheel`というグループに所属しているユーザーのみ、コマンドの前にsuduを付けることで、どのユーザーとして実行するかを指定できる
ユーザーを指定しなかった場合は`root`ユーザーとなる
`$ sudu コマンド`

rootユーザーで実行する場合にしか使用しないため、基本的に`$ sudu コマンド`だけ覚えればよい

`$ sudu yum install XXX`など

## ファイルとパーミッション
各ファイルには所有オーナーと所有グループが設定されている
通常はホワイトリスト方式で、基本的には権限を厳しく、必要な権限だけ適宜追加していくことが多い

### ファイルの権限を確認する
`ls`コマンドと`-l`オプション
`$ ls -l /etc/less`
`-rwxr-xr-x. 1 root root 158240 7月 31 2015 /bin/less`

#### ファイルタイプ
`-`部分(行頭)

`-` : 通常ファイル
`d` : ディレクトリ
`l` : リンク

#### パーミッション
`rwxr-xr-x`部分

`rwx` : オーナーのパーミッション
`r-x` : グループのパーミッション
`r-x` : 他のユーザーのパーミッション

#### オーナーとグループ
`root root`部分

`root` : ファイルのオーナーのユーザー名
`root` : グループ名

### パーミッションの設定
`rwx`で表現され、権限がない部分を`-`にしてあらわす

`r` : read(読み取り)
`w` : write(書き込み)
`x` : execute(実行・ディレクトリ移動)

`rwxr-xr-x`の場合、

`rwx` オーナーは全て許可
`r-x` グループは書き込み不可
`r-x` 他のユーザーは書き込み不可

### ファイルのパーミッションを変更する

#### chown
`$ chown ユーザー[.グループ] ファイル`

| option | 動作                     |
| ------ | ------------------------ |
| -R     | ディレクトリを対象に再帰処理 |

#### chgrp
`$ chgrp グループ ファイル`

| option | 動作                     |
| ------ | ------------------------ |
| -R     | ディレクトリを対象に再帰処理 |

#### chmod
`$ chmod [ugoa] [+-=] [rwx] ファイル`
ファイルの権限を変更する

[ugoa]
`u` : オーナーの権限
`g` : グループの権限
`o` : 他のユーザーの権限
`a` : 全ユーザーの権限

[+-=]
`+` : 権限を追加
`-` : 権限を削除
`=` : 記述した権限にする

`file`の
オーナーの権限にrwを追加、xを取り消し
グループと他のユーザーの権限にrを追加
`$ chmod u+rw-x,go+r file`

##### 8進数で各対象の権限をまとめて指定する
`$ chmod 8進数3桁 ファイル`

3桁の8進数は、各桁でオーナー、グループ、ユーザーそれぞれのパーミッションを表す

3つの権限`rwx`を3桁の2進数`111`と考え、結果を8進数として1桁にまとめる
- `rwx`は`111` 8進数で`7`
- `r-x`は`101` 8進数で`5`
- `r--`は`100` 8進数で`4`
それを繋げて、`rwxr-xr--`を`754`で表せる

`file`のパーミッションを`rwxr-xr--`に設定する
`$ chmod 754 file`

### umask パーミッションの初期値を変更する
新しく作成されるファイルのパーミッションは、
ファイルは`rw-rw-rw-`(`666`)、
ディレクトリは`rwxrwxrwx`(`777`)
で作られる

それらからumaskに設定された値をマスク(マイナス)した値が、パーミッションの初期値となる。

`$ umask`
現在のマスク値を表示
`$ umask 8進数3桁`
マスク値を設定

ファイル作成時のパーミッションを`rw-r-xr--`(`654`)にする
(`666` - `012` = `654`)
`$ umask 012`
`$ touch test_umask0012`
-> test_umask0012のパーミッションは`654`になる
