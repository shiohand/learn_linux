# ネットワークの設定
- [用語が多い](#用語が多い)
- [ping データ送受信の所要時間計測](#ping-データ送受信の所要時間計測)
- [traceroute tracepath 経由ゲートウェイの調査](#traceroute-tracepath-経由ゲートウェイの調査)
- [ip nmcli nmtui IPアドレスの確認](#ip-nmcli-nmtui-ipアドレスの確認)
- [IPアドレスの設定ファイル](#ipアドレスの設定ファイル)
  - [`/etc/sysconfig/network-scripts/ifcfg-XXX`](#etcsysconfignetwork-scriptsifcfg-xxx)
  - [`/etc/sysconfig/network`](#etcsysconfignetwork)
  - [設定ファイルの内容例](#設定ファイルの内容例)
  - [インターフェースの設定を変更する手順](#インターフェースの設定を変更する手順)
- [ルーティング](#ルーティング)
  - [ルーティングの確認](#ルーティングの確認)
  - [ルーティングの変更](#ルーティングの変更)
    - [ipコマンド](#ipコマンド)
    - [routeコマンド](#routeコマンド)
- [DNS](#dns)
- [FQDN](#fqdn)
- [ポート番号](#ポート番号)
- [サービスの確認](#サービスの確認)
  - [UDPサービスの表示](#udpサービスの表示)
- [ネットワークセキュリティ](#ネットワークセキュリティ)
  - [ファイアウォールの設定](#ファイアウォールの設定)
  - [iptablesへの切り替え](#iptablesへの切り替え)

## 用語が多い
TCP/IP LAN WAN...
(-> 基本情報技術者をする、マスタリングTCP/IP読む)

IPアドレスのクラス
| アドレス                  | サブネットマスク | クラス  | アドレス数 |
| ------------------------- | ---------------- | ------- | ---------- |
| 0.0.0.0~127.255.255.255   | 255.0.0.0        | クラスA | 16,777,216 |
| 128.0.0.0~127.255.255.255 | 255.255.0.0      | クラスB | 65,536     |
| 192.0.0.0~127.255.255.255 | 255.255.255.0    | クラスC | 256        |
| 224.0.0.0~127.255.255.255 |                  | クラスD |            |
| 240.0.0.0~127.255.255.255 |                  | クラスE |            |

## ping データ送受信の所要時間計測
`ping ターゲット`
ターゲット(ホスト名やIPアドレス)にデータを送り、返答が戻るまでの時間を表示する。
Ctrl+cで停止(CtrlはMacでもCtrl！)

| option | 動作                      |
| ------ | ------------------------- |
| -c N   | pingの発行回数をN回にする |

## traceroute tracepath 経由ゲートウェイの調査
`traceroute ターゲット`
`tracepath ターゲット`
ターゲットまでに仲介するゲートウェイを調べる

## ip nmcli nmtui IPアドレスの確認
`ip a [インターフェース]`
`ip address [インターフェース]`
ネットワークインターフェースと設定されたIPアドレスとサブネットマスクを確認(詳細)
インターフェース指定なしだと全て
`nmcli [インターフェース]`
タイプや状態の表示や、オプションによる設定ができる(シンプル)
インターフェース指定なしだと全て
`nmtui`
会話形で設定ができるインターフェース

ホストIPアドレスの確認
(うちでやれ)
```
$ ip a
1: lo: 
2: enp0s3: 
3: virbr0:
4: virbr0-nic
```
`lo` : ループバックインターフェース(機器が正常に動作しているか確認するテストなどに使用)
`enp0s3` : 物理的に存在するEthernetのネットワークインターフェース

## IPアドレスの設定ファイル
(RedHat系のディストリビューションの場合)IPアドレスの設定を2つの設定ファイルに記述そておく ブート時にそれらによって設定される

### `/etc/sysconfig/network-scripts/ifcfg-XXX`
`XXX`部分にはインターフェースのIPアドレスとサブネットマスクなどを記述
ループバックインターフェースの場合は`lo`
ネットワークインターフェースカードの場合は`enX0Y`,`enX1Y`...と、デバイスの種類とスロットにより番号が振られる

ifcfg設定ファイルの項目
| 項目      | 内容                                     |
| --------- | ---------------------------------------- |
| ONBOOT    | 起動時にアドレスを自動設定するか(yes/no) |
| DEVICE    | ネットワークインターフェース             |
| HWADDR    | MACアドレス                              |
| BOOTPROTO | 以降の設定を利用(static)か自動取得(dhcp) |

固定アドレス(static)を設定する場合の設定項目
| 項目    | 内容             |
| ------- | ---------------- |
| IPADDR  | IPアドレス       |
| NETMASK | サブネットマスク |
| NETWORK | ネットワーク     |

起動時にアドレスを自動設定するには、DHCP機能が提供された環境が必要

### `/etc/sysconfig/network`
データが他のネットワークへ転送されるゲートウェイのアドレスとホスト名を記述

| 項目       | 内容                               |
| ---------- | ---------------------------------- |
| NETWORKING | ネットワークを有効にするか(yes/no) |
| HOSTNAME   | ホスト名                           |
| GATEWAY    | ゲートウェイアドレス               |

### 設定ファイルの内容例
(うちでやれ)
`/etc/sysconfig/network-scripts/ifcfg-lo`
```
DEVICE=lo
IPADDR=127.0.0.1
NETMASK=255.0.0.0
NETWORK=127.0.0.0
# If you're having problems with gated making
127.0.0.0/8 a martian
やれ
```
`/etc/sysconfig/network-scripts/ifcfg-enp0s3`
```
TYPE=Ethernet
BOOTPROTO=dhcp
DEFROUTE=
IPV4_
やれや
```
MACアドレスはハードウェア自体に設定されているので変更しない

### インターフェースの設定を変更する手順
1. エディターで設定ファイルを書き換える
2. `systemctl restart [対象]`オプションで再起動

## ルーティング

### ルーティングの確認
`ss [option1 [option2]]`
確認を行う

| option1 | 動作                                   |
| ------- | -------------------------------------- |
| -V      | バージョン情報を表示                   |
| -a      | 全てのソケットを表示                   |
| -n      | サービス名に変換せず表示               |
| -r      | ホスト名を名前解決                     |
| -p      | ソケットを使用しているプロセスIDを表示 |
| -s      | 集約したソケット情報                   |
| -t      | TCPのソケットのみ                      |
| -u      | UDPのソケットのみ                      |
| -e      | 詳細なソケット情報を表示               |

| option2 | 動作     |
| ------- | -------- |
| -4      | IPv4のみ |
| -6      | IPv6のみ |

`ip route`
ルーティングテーブルを表示

### ルーティングの変更

#### ipコマンド
`ip r[oute] {コマンド|help}`

`ip route {add|del} ターゲット/サブネット via ゲートウェイアドレス dev インターフェース`
CIDR表記で指定する
delで削除
管理者権限が必要

#### routeコマンド
`route add [-net|-host] ターゲット [netmask サブネットマスク] [インターフェース]`
`add`指定で経路追加
ターゲットには宛先として、`-net`ならネットワークアドレス、`-host`ならホストアドレスを指定
`netmask サブネットマスク`省略時は自動判別のマスク値
`インターフェース`省略時は自動設定

## DNS
`/etc/nsswitch.conf`ファイルの`hosts:`の項目で、名前解決にファイルを使うか、DNSを使うかを指定する。
ファイル : `/etc/hosts`ファイルを参照
DNS : `/etc/resolv.conf`ファイルを見てDNSサーバを使う

## FQDN
`dig`
`nslookup ターゲット`
FQDNとIPの対応を確認する

## ポート番号
ウェルノウンポートの対応は`/etc/services`で確認できる
| 範囲        | 項目                         |
| ----------- | ---------------------------- |
| 0-1023      | WELL KNOWN PORT NUMBERS      |
| 1024-49151  | REGISTERED PORT NUMBERS      |
| 49152-65535 | DYNAMIC AND/OR PRIVATE PORTS |

## サービスの確認
`ss -a -t`でサービスやネットワークの状況を表示できる

### UDPサービスの表示
`netstat -a -u`

## ネットワークセキュリティ
`Linux標準教科書 10.9 ネットワークセキュリティ`
TCPラッパー : セキュリティを強化するための機能

サービスがTCPラッパー機能を提供するライブラリを利用していると使える

アクセスを制限する`/etc/hosts.deny`ファイル
アクセスを許可する`/etc/hosts.allow`ファイル

サービスを提供するプログラムのリストに対して`:`で区切り、適応するネットワークやIPアドレス、ホスト名やドメイン名などのクライアントのリストを書き、ファイルによって許可または拒否する。
クライアントのリストのあとには`:`で区切り、制限にかかる前に実行するシェルスクリプトを書ける。
全てを表すときはリストの代わりに`ALL`と記述

### ファイアウォールの設定
...
### iptablesへの切り替え
...
