# ファイル管理
- [ファイルシステム](#ファイルシステム)
  - [ジャーナリング機能](#ジャーナリング機能)
  - [`fsck` ファイルシステムチェック・修復](#fsck-ファイルシステムチェック修復)
  - [`du` ディレクトリ使用量の確認](#du-ディレクトリ使用量の確認)
- [パーティション](#パーティション)
  - [ラベル](#ラベル)
  - [スワップファイルシステムの作成](#スワップファイルシステムの作成)
- [ハードディスクの増設](#ハードディスクの増設)
- [マウント](#マウント)
  - [自動マウント](#自動マウント)
- [FHS(Filesystem Hierarchy Standard)](#fhsfilesystem-hierarchy-standard)
- [ファイルシステムの利用開始](#ファイルシステムの利用開始)
- [CD, DVD, USBメモリの利用](#cd-dvd-usbメモリの利用)
- [iノード](#iノード)

## ファイルシステム
ファイル名・属性データ(変更日付など)・ファイルデータ本体を効率よく管理する
システムには種類があり、効率や安全性が異なる

Linux : 概ね`ext3`か`ext4`
Windows : `NTFS`の各バージョン
CD,DVD,BD : `ISO9660`規格

その他のファイルシステム
(-> Linux標準教科書 12.3)

### ジャーナリング機能
ファイルシステムに対する書き換え処理のコマンドを記録
`ex3`移行のファイルシステムの多くはこれを取り入れている

### `fsck` ファイルシステムチェック・修復
`fsck デバイス名`
ファイルシステムのチェックと修復を行う
コンピュータの異常終了などで不整合に陥ったとき
異常終了後のシステム起動時には自動で実行されている

ジャーナリング機能があると素早く行える
むしろないとおそすぎる

### `du` ディレクトリ使用量の確認
`du [ディレクトリ、ファイル]`
ディレクトリの使用量、ファイルのサイズを調べる
`-s` 指定した総計を表示

## パーティション
ハードディスクを利用するために区切った単位
パーティションを作ること=パーティショニング

`fdisk [デバイスファイル]`
パーティションの確認(`-l`オプション)、作成、削除が可能

メリット
- バックアップ頻度を分ける
- 障害発生時の影響範囲の切り分け
- ファイルアクセスの速度向上

1台のハードディスクは、
・任意の数の`基本パーティション`と
・1つまでの`拡張パーティション`を作ることができ
・4つまで分けられる
拡張パーティション内にファイルシステムは作成できないが、基本パーティションと同様に使用できる`論理パーティション`を複数作成できる

Linuxでは4つ以上のパーティションが必要となるケースが多い

拡張されたハードディスクは、LVM機能他で複数のハードディスクを統合した1つのハードディスクとして大きく使うことも多い

| 規格 | パーティションの最大数(基本+論理) |
| ---- | --------------------------------- |
| IDE  | 63(3+60)                          |
| SATA | 15(3+12)                          |
| SCSI | 15(3+12)                          |

### ラベル
パーティションを認識するための名前
ファイルシステムの作成時につけるか、`e2label`コマンドで付ける

`e2label デバイス [ラベル]`
パーティションのラベルの表示
ラベルの付与

### スワップファイルシステムの作成
インストール時やハードディスクの増設時に実行

`mkswap デバイスファイル`
スワップ領域(スワップのパーティション)を作る
`-c` ディスクの不良部分を探し、使用しない

`swapon [デバイスファイル]`
作成したスワップ領域を有効化
`ｰs` 利用中のスワップ領域を表示

`swapoff [デバイスファイル]`
`-v` 指定したスワップを無効化
`-s` 全てのスワップを無効化

手順(-> Linux標準教科書 12.5.2)

## ハードディスクの増設
データ用の領域とスワップ領域(メモリ代わりにプログラムが置かれる)の2つを作成

...(-> Linux標準教科書 12.2.3)

## マウント
まずひとつ、全ての親となるディスク(マウントポイント)をルートディレクトリ(`/`)にマウントする
複数のディスクを使用する際は、1つ目のディスク内のディレクトリにマウントする
(マウント先にデータがあると無視して初期化されるので退避しておく)

`df`コマンド
マウントされているファイルシステムのリストを表示

`mount -t タイプ -o オプション デバイスファイル マウントポイント`
ハードディスク、リムーバブルメディアをマウント

`umount マウントポイント`
ハードディスク、リムーバブルディスクをアンマウント

### 自動マウント
インストール時に作られたパーティションは、コンピュータの起動時に自動マウント
自動マウントの設定は`/etc/fstab`にある設定ファイルに記述

`/etc/fstab`
- ブロクスペシャルデバイス
- マウントポイント
- ファイルシステムのタイプ
- オプション
- dumpコマンドがダンプ(バックアップ)するか否か
- ブート時にチェックする順番

`mount`コマンド
`-a` `/etc/fstab`で指定されたswap以外のパーティションをマウント

## FHS(Filesystem Hierarchy Standard)
ディレクトリの構成を定めている規格

一般ユーザ用プログラム `bin`
システム管理用プログラム `sbin`
設定ファイル `etc`
などのようにディレクトリの用途をゆるやかに定め得ている

## ファイルシステムの利用開始
ハードディスクを設定してファイルシステムとして使う

1. `fdisk` : パーティション作成
2. `mkfs` : ファイルシステムの作成
3. `mount` : マウント

...

`mkfs`option|-
-|-
`-t`|ファイルシステムの種類を指定
`-c`|ハードディスクの壊れている箇所を検出、利用しない

## CD, DVD, USBメモリの利用
リムーバブルメディアは(一部のディストリビューション以外は)手動でマウントする
マウントポイントとして`/mnt`や`/media`内のディレクトリが使われる

(-> Linux標準教科書 12.7)

## iノード
`ext3`(`ext2`なども)ファイルシステムは、ファイルやディレクトリに対し、iノード番号というユニークな番号を割り振って管理している。
ファイルのディスク上の位置やアクセス権限などの情報が保持
容量は足りていてもiノード領域が不足しているとファイルが作成できなくなる

`df -i`
iノード情報の表示
`ls -i`
ファイルのiノード番号を確認